// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  user
  admin
}

enum Label {
  Home
  Office
  School
  Apartment
}

enum Delivery {
  delivery
  pickup
}

enum PaymentStatus {
  pending
  paid
  expired
  failed
  refunded
}

enum OrderStatus {
  pending
  processing
  delivery
  success
  cancelled
}

model users {
  id       Int    @id @default(autoincrement())
  role     Role   @default(user)
  name     String
  username String @unique
  phone    String
  password String

  address         address[]
  cart            carts[]
  checkout        checkouts[]
  review          reviews[]
  insight_product insight_products[]
}

model address {
  id           Int     @id @default(autoincrement())
  recipient    String
  label        Label
  city         String
  subdistrict  String
  zip_code     Int
  address      String
  main_address Boolean
  user_id      Int
  longitude    String?
  latitude     String?
  description  String?

  user     users        @relation(fields: [user_id], references: [id])
  delivery deliveries[]
}

model products {
  id            Int      @id @default(autoincrement())
  name          String
  description   String
  sold          Int
  categories_id Int
  created_at    DateTime @default(now())

  category         categories          @relation(fields: [categories_id], references: [id])
  variant          variants[]
  product_images   product_images[]
  cart             carts[]
  product_checkout product_checkouts[]
  review           reviews[]
  insight_product  insight_products[]
}

model product_images {
  id         Int    @id @default(autoincrement())
  image_path String
  product_id  Int

  product products @relation(fields: [product_id], references: [id])
}

model categories {
  id       Int    @id @default(autoincrement())
  category String @unique

  product products[]
}

model variants {
  id            Int    @id @default(autoincrement())
  variant       String 
  price         Int
  stock         Int
  product_id    Int

  product          products           @relation(fields: [product_id], references: [id])
  cart             carts[]
  product_checkout product_checkouts[]
}

model carts {
  id         Int @id @default(autoincrement())
  quantity   Int
  price      Int
  product_id Int
  variant_id Int
  user_id    Int

  product products @relation(fields: [product_id], references: [id])
  variant variants @relation(fields: [variant_id], references: [id])
  user    users    @relation(fields: [user_id], references: [id])
}

model product_checkouts {
  id          Int @id @default(autoincrement())
  quantity    Int
  price       Int
  product_id  Int
  variant_id  Int
  checkout_id Int

  product  products  @relation(fields: [product_id], references: [id])
  variant  variants  @relation(fields: [variant_id], references: [id])
  checkout checkouts @relation(fields: [checkout_id], references: [id])
}

model deliveries {
  id             Int      @id @default(autoincrement())
  delivery_type  Delivery
  pickup_date    String?
  pickup_hour    String?
  delivery_price Int
  address_id     Int

  address  address    @relation(fields: [address_id], references: [id])
  checkout checkouts?
}

model checkouts {
  id               Int      @id @default(autoincrement())
  order_id         String   @unique
  total_price      Int
  estimation       String
  description      String?
  gift_card        Boolean
  gift_description String?
  snap_token       String?
  user_id          Int
  delevery_id      Int      @unique
  created_at       DateTime @default(now())

  user             users      @relation(fields: [user_id], references: [id])
  delivery         deliveries @relation(fields: [delevery_id], references: [id])
  status           status[]
  product_checkout product_checkouts[]
  review           reviews?
}

model status {
  id             Int             @id @default(autoincrement())
  payment_status PaymentStatus?
  order_status   OrderStatus
  description    String?
  checkout_id    Int
  created_at     DateTime        @default(now())

  checkout       checkouts       @relation(fields: [checkout_id], references: [id])
}

model reviews {
  id Int @id @default(autoincrement())
  star Int 
  description String
  product_id Int
  user_id Int
  checkout_id Int @unique
  created_at DateTime @default(now())

  product  products   @relation(fields: [product_id], references: [id])
  user     users      @relation(fields: [user_id], references: [id])
  checkout checkouts  @relation(fields: [checkout_id], references: [id])
}

model insight_products {
  id Int @id @default(autoincrement())
  user_id Int
  product_id Int

  product  products   @relation(fields: [product_id], references: [id])
  user     users      @relation(fields: [user_id], references: [id])
}

model contacts {
  id Int @id @default(autoincrement())
  name String
  email String
  topic String
  description String
}